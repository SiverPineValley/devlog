---
title: '2-9) 클라이언트 메타데이터와 브로커 통신'
date: 2024-12-07 15:30:00
category: 'kafka'
draft: false
---

-  카프카 클라이언트는 통신하고자 하는 `리더 파티션의 위치`를 알기 위해 데이터를 주고 (프로듀서) 받기 (컨슈머) 전에 메타데이터를 브로커로부터 전달받는다. 메타데이터는 다음과 같은 옵션을 통해 리프레쉬된다.

- `metadata.max.age.ms`: 메타데이터를 강제로 리프레쉬하는 간격. 기본값은 5분.
- `metadata.max.idle.ms`: 프로듀서가 유휴상태일 때 메타데이터를 캐시에 유지하는 기간.  예를 들어, 프로듀서가 특정 토픽으로 데이터를 보낸 이후 지정된 시간이 지나고 나면 강제로 메타데이터를 리프레시. 기본값은 5분.

- 카프카 클라이언트는 반드시 리더 파티션과 통신해야 하는데, 가끔 리프레시 이후 리더 파티션이 아닌 파티션과 통신하다 보면 `LEADER_NOT_AVAILABLE` 이라는 에러가 발생한다. 이 에러는 클라이언트가 데이터를 요청한 브로커에 리더 파티션이 없는 경우이며 대부분 메타데이터 리프레시 이슈로 발생한다. 이 에러가 자주 발생하면 메타데이터 리프레시 간격을 확인하고 클라이언트가 정상적인 메타데이터를 가지고 있는지 확인해야 한다.