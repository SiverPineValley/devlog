---
title: '2-4) 복제 (replication)'
date: 2024-12-07 14:50:00
category: 'kafka'
draft: false
---

- `복제(replication)`은 브로커의 또 다른 역할 중 하나이다.

</br>

<div align="left">
  <img src="./images/스크린샷 2024-12-07 오후 2.41.51.png" width="500px" />
</div>

</br>

- 데이터 복제는 카프카를 장애 허용 시스템 (fault tolerant system)으로 동작하게 하는 원동력이다. 복제는 클러스터로 묶인 일부에 장애가 발생하더라도, 데이터를 유실하지 않고 안전하게 사용하기 위함이다. 카프카의 데이터 복제는 파티션 단위로 이루어지는데, 토픽이 생성될 때 파티션의 복제 개수 (replication factor)에 따라 파티션 복제 개수가 설정된다. 최소 값은 1 (복제 없음) 이고, 최대는 브로커의 개수만큼이다.
- 복제된 파티션은 `리더(leader)`와 `팔로워(follower)`로 이루어진다. 프로듀서/컨슈머와 직접 통신하는 파티션을 리더, 나머지 복제된 데이터를 가진 파티션을 팔로워라고 한다. 팔로워 파티션은 리더 파티션의 오프셋을 확인하여 자신이 가진 오프셋과 차이가 나는 경우 리더 파티션으로 부터 데이터를 가져와 저장하는데, 이를 복제라고 한다.
- 파티션 복제로 인해 나머지 팔로워에도 같은 내용이 저장되므로, 복제 개수 만큼 저장 용량이 증가한다는 단점이 있다. 그러나, **복제를 통해 데이터를 안전하게 사용할 수 있다는 강력한 장점 때문에 카프카를 사용할 때 2 이상의 복제를 두는 것이 중요하다.**
- 브로커에 장애가 발생해 다운되면, 팔로워 파티션 중 하나가 리더 파티션으로 승급된다. 이를 통해 데이터가 유실되지 않고 컨슈머나 프로듀서와 데이터를 주고 받도록 동작할 수 있다. 운영 시에는 데이터/토픽 마다 이러한 복제 개수를 다르게 설정하기도 한다. 속도가 중요하다면 복제의 개수를 조금 줄이고, 금융권 같이 데이터의 유실이 적어야 한다면 3 이상으로 설정하기도 한다.